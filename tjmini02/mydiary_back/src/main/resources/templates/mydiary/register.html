<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<th:block th:replace="~{/layout/basic :: setContent(~{this::content} )}">
  <th:block th:fragment="content">
    <h1 class="mt-4">게시물 작성</h1>

      <div class="form-group">
        <label>일기 제목</label>
        <input type="text" class="form-control" name="title" placeholder="Enter Title">
      </div>
      <div class="form-group">
      <fieldset>
   		<legend>오늘의 날씨</legend>
	    <div>
	      <input type="radio" id="해가 쨍쨍" name="weather" value="해가 쨍쨍">
	      <label for="해가 쨍쨍">해가 쨍쨍</label>
	     </div>
	    <div>
	      <input type="radio" id="구름 가득" name="weather" value="구름 가득">
	      <label for="구름 가득">구름 가득</label>
	    </div>
	    <div>
	      <input type="radio" id="강풍!!" name="weather" value="강풍!!">
	      <label for="강풍!!">강풍!!</label>
	    </div>
	    <div>
	      <input type="radio" id="비가 주룩주룩" name="weather" value="비가 주룩주룩">
	      <label for="비가 주룩주룩">비가 주룩주룩</label>
	    </div>
	</fieldset>
      </div>
      <div class="form-group">
        <label>일기 내용</label>
        <textarea class="form-control" rows="5" name="content"></textarea>
      </div>
      <div class="form-check">
      	<label>비밀글인가요?</label>
      	<input class="form-check-input" type="checkbox" name="isSecret">
      </div>
      <div class="form-check">
      	<label>답글을 달 수 있나요?</label>
      	<input class="form-check-input" type="checkbox" name="canReply">
      </div>
      <div class="form-group">
		<input name ="uploadFiles" id="uploadFiles" type="file" accept="image/*" multiple/>
		<ul >
		</ul>
      </div>
      <input type="button" class="btn btn-primary regiBtn">일기 등록하기</button>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
	<script>
		document.getElementById("uploadFiles").addEventListener("change", (e)=>{
			// 이벤트를 처리할 때 this는 이벤트가 발생한 객체
			// 여기서는 document.getElementByID("uploadFiles")입니다.
			readURL(e.target);
		});
		function readURL(input){
			if(input.files && input.files[0]){
				console.log("이미지 인식!!");
				var filename = input.files[0].name;
				var reader = new FileReader();
				
				reader.addEventListener("load", function(e){
					document.getElementById("img").src = e.target.result;
				});
				reader.readAsDataURL(input.files[0]);
				showUploadedImages(result);
			}
		}
		
		$('.regiBtn').click(function(){
	        var formData = new FormData();
			var title = $('input[name="title"]').val();
			formData.append("title", title);
			var weather = $('input[name="weather"]:checked').val();
			formData.append("weather", weather);
			var content = $('input[name="content"]').val();
			formData.append("content", content);
			var canReply = $('input:checkbox[id="canReply"]').is(':checked') ? 1 : 0;
			formData.append("canReply", canReply);
			var isSecret = $('input:checkbox[id="isSecret"]').is(':checked') ? 1 : 0;
			formData.append("isSecret",isSecret);
	        var inputFile = $("input[type='file']");
	        var files = inputFile[0].files;
	        if(files.length < 1){
	            alert("업로드할 파일을 선택하지 않으셨습니다.");
	            return;
	        }
	        for (var i = 0; i < files.length; i++) {
	            console.log(files[i]);
	            formData.append("image", files[i]);
	        }
	        $.ajax({
	        	url:"/mydiary/register",
	        	processData:false,
	        	contentType:false,
	        	data:formData,
	        	type:"POST",
	        	dataType:"json",
	        	sucess:function(result){
	        		console.log(result);
	        		alert("글 등록 성공!")
	        	},
	        	error:function(jqXHR, textstatus, errorThrown){
	        		console.log(textstatus);
	        	}
	        })
		})
		
		function showUploadedImages(ar){
			var divArea = $('.uploadResult');
			for(var i = 0; i < ar.length; i++){
				divArea.append("<li><img src='display?filename="+ ar[i].imageURL + "'></li>");
			}	
		}
	</script>
  </th:block>
</th:block>
      